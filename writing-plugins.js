(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{97:function(s,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var o,i=n(e(3)),r=function(s){if(s&&s.__esModule)return s;var a={};if(null!=s)for(var e in s)if(Object.prototype.hasOwnProperty.call(s,e)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(s,e):{};o.get||o.set?Object.defineProperty(a,e,o):a[e]=s[e]}return a.default=s,a}(e(0));n(e(2)),n(e(122));function n(s){return s&&s.__esModule?s:{default:s}}function t(s,a,e,i){o||(o="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var r=s&&s.defaultProps,n=arguments.length-3;if(a||0===n||(a={children:void 0}),a&&r)for(var t in r)void 0===a[t]&&(a[t]=r[t]);else a||(a=r||{});if(1===n)a.children=i;else if(n>1){for(var l=new Array(n),d=0;d<n;d++)l[d]=arguments[d+3];a.children=l}return{$$typeof:o,type:s,key:void 0===e?null:""+e,ref:null,props:a,_owner:null}}function l(s,a,e){return a in s?Object.defineProperty(s,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):s[a]=e,s}function d(){return(d=Object.assign||function(s){for(var a=1;a<arguments.length;a++){var e=arguments[a];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(s[o]=e[o])}return s}).apply(this,arguments)}function p(s,a){if(null==s)return{};var e,o,i=function(s,a){if(null==s)return{};var e,o,i={},r=Object.keys(s);for(o=0;o<r.length;o++)e=r[o],a.indexOf(e)>=0||(i[e]=s[e]);return i}(s,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);for(o=0;o<r.length;o++)e=r[o],a.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(s,e)&&(i[e]=s[e])}return i}const c=s=>{let{to:a}=s,e=p(s,["to"]);return a.includes("http")?r.default.createElement("a",d({},s,{href:a})):("#"===a[0]&&(a=i.default.join("/auto/","pages/plugins/writing-plugins.html")+a),r.default.createElement("a",d({},e,{href:a,onClick:e=>{if(e.preventDefault(),"#"===s.to)return!1;const o=new URL(i.default.join(window.location.origin,a));window.history.pushState((s=>({href:s.href,pathname:s.pathname,hash:s.hash,query:s.query}))(o),null,a),s.onClick();const r=new CustomEvent("changeLocation",{detail:o});return dispatchEvent(r),!1}})))};c.defaultProps={href:"",onClick:()=>{}};const u=s=>{var a,e;return e=a=class extends r.default.Component{constructor(...s){super(...s),l(this,"state",{Comp:null})}componentDidMount(){!this.state.Comp&&this.props.shouldLoad&&s().then(s=>{this.setState({Comp:s.default})})}render(){const{Comp:s}=this.state;return s?r.default.createElement(s,this.props,this.props.children||null):null}},l(a,"defaultProps",{shouldLoad:!0}),e};u(()=>e.e(32).then(e.bind(null,123))),u(()=>e.e(32).then(e.bind(null,124)));var m=t("h1",{},void 0,"Writing Plugins"),h=t("p",{},void 0,"If you've ever written a ",t("code",{},void 0,"webpack")," plugin it's a lot like that."),v=t("p",{},void 0,"A plugin definition is:"),g=t("li",{},void 0,"a class the has an ",t("code",{},void 0,"apply")," function where a plugin hooks into various functions in auto (REQUIRED)"),b=t("pre",{},void 0,t("code",{className:"language-ts"},void 0,t("span",{className:"hljs-keyword"},void 0,"import")," { Auto, IPlugin } ",t("span",{className:"hljs-keyword"},void 0,"from")," ",t("span",{className:"hljs-string"},void 0,'"auto"'),";",t("br",{}),t("br",{}),t("span",{className:"hljs-keyword"},void 0,"export")," ",t("span",{className:"hljs-keyword"},void 0,"default")," ",t("span",{className:"hljs-keyword"},void 0,"class")," TestPlugin ",t("span",{className:"hljs-keyword"},void 0,"implements")," IPlugin {",t("br",{}),"  name = ",t("span",{className:"hljs-string"},void 0,'"test"'),";",t("br",{}),t("br",{}),"  ",t("span",{className:"hljs-comment"},void 0,"/** Tap into auto plugin points. */"),t("br",{}),"  apply(auto: Auto) {}",t("br",{}),"}",t("br",{}))),N=t("p",{},void 0,"Or in JavaScript:"),j=t("pre",{},void 0,t("code",{className:"language-js"},void 0,t("span",{className:"hljs-built_in"},void 0,"module"),".exports = ",t("span",{className:"hljs-class"},void 0,t("span",{className:"hljs-keyword"},void 0,"class")," ",t("span",{className:"hljs-title"},void 0,"TestPlugin")," "),"{",t("br",{}),"  ",t("span",{className:"hljs-keyword"},void 0,"constructor"),"() {",t("br",{}),"    ",t("span",{className:"hljs-keyword"},void 0,"this"),".name = ",t("span",{className:"hljs-string"},void 0,'"test"'),";",t("br",{}),"  }",t("br",{}),t("br",{}),"  ",t("span",{className:"hljs-comment"},void 0,"/**",t("br",{}),"   * Tap into auto plugin points.",t("br",{}),"   * @param {import('@auto-it/core').default} auto",t("br",{}),"   */"),t("br",{}),"  apply(auto) {}",t("br",{}),"};",t("br",{}))),f=t("p",{},void 0,"Plugins work by hooking into various actions that ",t("code",{},void 0,"auto")," has to do in order to facilitate a release or interact with your GitHub repo."),y=t("p",{},void 0,"Most plugins will find the need to some some options from the user. The constructor of the plugin gets access to the options passed in the ",t("code",{},void 0,".autorc"),"."),k=t("pre",{},void 0,t("code",{className:"language-ts"},void 0,t("span",{className:"hljs-keyword"},void 0,"import")," { Auto, IPlugin } ",t("span",{className:"hljs-keyword"},void 0,"from")," ",t("span",{className:"hljs-string"},void 0,'"@auto-it/core"'),";",t("br",{}),t("br",{}),t("span",{className:"hljs-keyword"},void 0,"interface")," TestPluginOptions {",t("br",{}),"  someOption?: ",t("span",{className:"hljs-built_in"},void 0,"boolean"),";",t("br",{}),"}",t("br",{}),t("br",{}),t("span",{className:"hljs-keyword"},void 0,"export")," ",t("span",{className:"hljs-keyword"},void 0,"default")," ",t("span",{className:"hljs-keyword"},void 0,"class")," TestPlugin ",t("span",{className:"hljs-keyword"},void 0,"implements")," IPlugin {",t("br",{}),"  ",t("span",{className:"hljs-comment"},void 0,"/** The name of the plugin */"),t("br",{}),"  name = ",t("span",{className:"hljs-string"},void 0,'"test"'),";",t("br",{}),t("br",{}),"  ",t("span",{className:"hljs-comment"},void 0,"/** The options of the plugin */"),t("br",{}),"  readonly options: TestPluginOptions;",t("br",{}),t("br",{}),"  ",t("span",{className:"hljs-comment"},void 0,"/** Initialize the plugin with it's options */"),t("br",{}),"  ",t("span",{className:"hljs-keyword"},void 0,"constructor"),"(",t("span",{className:"hljs-params"},void 0,"options: TestPluginOptions"),") {",t("br",{}),"    ",t("span",{className:"hljs-keyword"},void 0,"this"),".options = options;",t("br",{}),"  }",t("br",{}),"}",t("br",{}))),w=t("code",{},void 0,"auto"),P=t("code",{},void 0,"io-ts"),O=t("p",{},void 0,"First install the following:"),x=t("pre",{},void 0,t("code",{className:"language-sh"},void 0,"npm i --save io-ts fp-ts",t("br",{}),t("span",{className:"hljs-comment"},void 0,"# or"),t("br",{}),"yarn add io-ts fp-ts",t("br",{}))),T=t("p",{},void 0,"Then convert your options interface to the equivalent ",t("code",{},void 0,"io-ts")," structure."),M=t("pre",{},void 0,t("code",{className:"language-ts"},void 0,t("span",{className:"hljs-keyword"},void 0,"import")," * ",t("span",{className:"hljs-keyword"},void 0,"as")," t ",t("span",{className:"hljs-keyword"},void 0,"from")," ",t("span",{className:"hljs-string"},void 0,'"io-ts"'),";",t("br",{}),t("br",{}),t("span",{className:"hljs-keyword"},void 0,"const")," pluginOptions = t.partial({",t("br",{}),"  someOption: t.boolean,",t("br",{}),"});",t("br",{}),t("br",{}),t("span",{className:"hljs-keyword"},void 0,"export")," ",t("span",{className:"hljs-keyword"},void 0,"type")," TestPluginOptions = t.TypeOf<",t("span",{className:"hljs-keyword"},void 0,"typeof")," pluginOptions>;",t("br",{}))),C=t("p",{},void 0,"Then tap into the ",t("code",{},void 0,"validateConfig")," hook and use the ",t("code",{},void 0,"validatePluginConfiguration")," utility."),E=t("pre",{},void 0,t("code",{className:"language-ts"},void 0,t("span",{className:"hljs-keyword"},void 0,"import")," { validatePluginConfiguration } ",t("span",{className:"hljs-keyword"},void 0,"from")," ",t("span",{className:"hljs-string"},void 0,'"@auto-it/core"'),";",t("br",{}),t("br",{}),t("span",{className:"hljs-keyword"},void 0,"export")," ",t("span",{className:"hljs-keyword"},void 0,"default")," ",t("span",{className:"hljs-keyword"},void 0,"class")," MyPlugin ",t("span",{className:"hljs-keyword"},void 0,"implements")," IPlugin {",t("br",{}),"  ",t("span",{className:"hljs-comment"},void 0,"// ..."),t("br",{}),"  apply(auto: Auto) {",t("br",{}),"    auto.hooks.validateConfig.tapPromise(",t("span",{className:"hljs-keyword"},void 0,"this"),".name, ",t("span",{className:"hljs-keyword"},void 0,"async")," (name, options) => {",t("br",{}),"      ",t("span",{className:"hljs-keyword"},void 0,"if")," (name === ",t("span",{className:"hljs-keyword"},void 0,"this"),".name || name === `auto-plugin-${",t("span",{className:"hljs-keyword"},void 0,"this"),".name}`) {",t("br",{}),"        ",t("span",{className:"hljs-keyword"},void 0,"return")," validatePluginConfiguration(",t("span",{className:"hljs-keyword"},void 0,"this"),".name, pluginOptions, options);",t("br",{}),"      }",t("br",{}),"    });",t("br",{}),"  }",t("br",{}),"}",t("br",{}))),S=t("p",{},void 0,"And that's it! Now ",t("code",{},void 0,"auto")," will validate your plugins configuration before running."),_=t("p",{},void 0,"To create a plugin simply make a class with an ",t("code",{},void 0,"apply")," method and tap into the hooks you need."),A=t("pre",{},void 0,t("code",{className:"language-ts"},void 0,t("span",{className:"hljs-keyword"},void 0,"import")," * ",t("span",{className:"hljs-keyword"},void 0,"as")," fs ",t("span",{className:"hljs-keyword"},void 0,"from")," ",t("span",{className:"hljs-string"},void 0,'"fs"'),";",t("br",{}),t("span",{className:"hljs-keyword"},void 0,"import")," { promisify } ",t("span",{className:"hljs-keyword"},void 0,"from")," ",t("span",{className:"hljs-string"},void 0,'"util"'),";",t("br",{}),t("br",{}),t("span",{className:"hljs-keyword"},void 0,"import")," { IAutoHooks, Auto, SEMVER, execPromise } ",t("span",{className:"hljs-keyword"},void 0,"from")," ",t("span",{className:"hljs-string"},void 0,'"auto"'),";",t("br",{}),t("span",{className:"hljs-keyword"},void 0,"import")," getConfigFromPackageJson ",t("span",{className:"hljs-keyword"},void 0,"from")," ",t("span",{className:"hljs-string"},void 0,'"./package-config"'),";",t("br",{}),t("br",{}),t("span",{className:"hljs-keyword"},void 0,"const")," readFile = promisify(fs.readFile);",t("br",{}),t("br",{}),t("span",{className:"hljs-keyword"},void 0,"export")," ",t("span",{className:"hljs-keyword"},void 0,"default")," ",t("span",{className:"hljs-keyword"},void 0,"class")," NPMPlugin {",t("br",{}),"  ",t("span",{className:"hljs-keyword"},void 0,"public")," apply(auto: Auto) {",t("br",{}),"    auto.hooks.getAuthor.tapPromise(",t("span",{className:"hljs-string"},void 0,'"NPM"'),", ",t("span",{className:"hljs-keyword"},void 0,"async")," () => {",t("br",{}),"      ",t("span",{className:"hljs-keyword"},void 0,"const")," { author } = ",t("span",{className:"hljs-built_in"},void 0,"JSON"),".parse(",t("span",{className:"hljs-keyword"},void 0,"await")," readFile(",t("span",{className:"hljs-string"},void 0,'"package.json"'),", ",t("span",{className:"hljs-string"},void 0,'"utf-8"'),"));",t("br",{}),t("br",{}),"      ",t("span",{className:"hljs-keyword"},void 0,"if")," (author) {",t("br",{}),"        auto.logger.log.info(",t("span",{className:"hljs-string"},void 0,'"NPM: Got author information from package.json"'),");",t("br",{}),"        ",t("span",{className:"hljs-keyword"},void 0,"return")," author;",t("br",{}),"      }",t("br",{}),"    });",t("br",{}),t("br",{}),"    auto.hooks.getPreviousVersion.tapPromise(",t("span",{className:"hljs-string"},void 0,'"NPM"'),", ",t("span",{className:"hljs-keyword"},void 0,"async")," () => {",t("br",{}),"      ",t("span",{className:"hljs-keyword"},void 0,"const")," { version } = ",t("span",{className:"hljs-built_in"},void 0,"JSON"),".parse(",t("span",{className:"hljs-keyword"},void 0,"await")," readFile(",t("span",{className:"hljs-string"},void 0,'"package.json"'),", ",t("span",{className:"hljs-string"},void 0,'"utf-8"'),"));",t("br",{}),t("br",{}),"      auto.logger.log.info(",t("br",{}),"        ",t("span",{className:"hljs-string"},void 0,'"NPM: Got previous version from package.json - "'),",",t("br",{}),"        version",t("br",{}),"      );",t("br",{}),t("br",{}),"      ",t("span",{className:"hljs-keyword"},void 0,"if")," (version) {",t("br",{}),"        ",t("span",{className:"hljs-keyword"},void 0,"return")," auto.prefixRelease(",t("br",{}),"          ",t("span",{className:"hljs-built_in"},void 0,"JSON"),".parse(",t("span",{className:"hljs-keyword"},void 0,"await")," readFile(",t("span",{className:"hljs-string"},void 0,'"package.json"'),", ",t("span",{className:"hljs-string"},void 0,'"utf-8"'),")).version",t("br",{}),"        );",t("br",{}),"      }",t("br",{}),"    });",t("br",{}),t("br",{}),"    auto.hooks.getRepository.tapPromise(",t("span",{className:"hljs-string"},void 0,'"NPM"'),", ",t("span",{className:"hljs-keyword"},void 0,"async")," () => {",t("br",{}),"      auto.logger.log.info(",t("span",{className:"hljs-string"},void 0,'"NPM: getting repo information from package.json"'),");",t("br",{}),"      ",t("span",{className:"hljs-keyword"},void 0,"return")," getConfigFromPackageJson();",t("br",{}),"    });",t("br",{}),t("br",{}),"    auto.hooks.publish.tapPromise(",t("span",{className:"hljs-string"},void 0,'"NPM"'),", ",t("span",{className:"hljs-keyword"},void 0,"async")," (version: SEMVER) => {",t("br",{}),"      ",t("span",{className:"hljs-keyword"},void 0,"await")," execPromise(",t("span",{className:"hljs-string"},void 0,'"npm"'),", [",t("br",{}),"        ",t("span",{className:"hljs-string"},void 0,'"version"'),",",t("br",{}),"        version,",t("br",{}),"        ",t("span",{className:"hljs-string"},void 0,'"-m"'),",",t("br",{}),"        ",t("span",{className:"hljs-string"},void 0,'"Bump version to: %s [skip ci]"'),",",t("br",{}),"      ]);",t("br",{}),"      ",t("span",{className:"hljs-keyword"},void 0,"await")," execPromise(",t("span",{className:"hljs-string"},void 0,'"npm"'),", [",t("span",{className:"hljs-string"},void 0,'"publish"'),"]);",t("br",{}),"      ",t("span",{className:"hljs-keyword"},void 0,"await")," execPromise(",t("span",{className:"hljs-string"},void 0,'"git"'),", [",t("br",{}),"        ",t("span",{className:"hljs-string"},void 0,'"push"'),",",t("br",{}),"        ",t("span",{className:"hljs-string"},void 0,'"--follow-tags"'),",",t("br",{}),"        ",t("span",{className:"hljs-string"},void 0,'"--set-upstream"'),",",t("br",{}),"        auto.remote,",t("br",{}),"        ",t("span",{className:"hljs-string"},void 0,'"$branch"'),",",t("br",{}),"      ]);",t("br",{}),"    });",t("br",{}),"  }",t("br",{}),"}",t("br",{})));var I=s=>t("div",{className:s.className},void 0,t("section",{},void 0,m,h,v,t("ul",{},void 0,t("li",{},void 0,"a name for the plugin, should match the ",t(c,{currentPage:s.currentPage,to:"/auto/pages/plugins.html#plugin-declaration"},void 0,"name of the package")," (REQUIRED)"),g),b,N,j,t("h2",{id:"hooks"},void 0,"Hooks ",t(c,{currentPage:s.currentPage,className:"fas fa-hashtag headerLink",to:"#hooks","aria-hidden":"true"})),f,t("p",{},void 0,t(c,{currentPage:s.currentPage,to:"/auto/pages/plugins/hook-api-docs.html"},void 0,"Read more about using hooks")),t("h2",{id:"adding-options"},void 0,"Adding Options ",t(c,{currentPage:s.currentPage,className:"fas fa-hashtag headerLink",to:"#adding-options","aria-hidden":"true"})),y,k,t("h3",{id:"validation"},void 0,"Validation ",t(c,{currentPage:s.currentPage,className:"fas fa-hashtag headerLink",to:"#validation","aria-hidden":"true"})),t("p",{},void 0,"To get validate of the options passed to plugins, ",w," uses ",t(c,{currentPage:s.currentPage,target:"_blank",to:"https://github.com/gcanti/io-ts",className:"external-link"},void 0,"io-ts")," and exports a utility function to validate the structured produced by ",P,". It lets you defined your interfaces in JavaScript and easily convert them to TypeScript. This means it's super simple to have type-safe code and runtime validation checking!"),O,x,T,M,C,E,S,t("h2",{id:"example-plugin---npm-(simple)"},void 0,"Example Plugin - NPM (simple) ",t(c,{currentPage:s.currentPage,className:"fas fa-hashtag headerLink",to:"#example-plugin---npm-(simple)","aria-hidden":"true"})),_,A,t("p",{},void 0,t(c,{currentPage:s.currentPage,to:"/auto/pages/plugins/writing-publishing-plugins.html"},void 0,"Read more about creating publishing plugins."))));a.default=I,s.exports=a.default}}]);
//# sourceMappingURL=writing-plugins.js.map